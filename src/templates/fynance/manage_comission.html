{% extends "base.html" %}

{% block main %}
<section class="container my-5">
    <div class="card mx-auto shadow-lg" style="max-width: 1200px;">
        <div class="card-body p-5">
            <h3 class="card-title">Calculadora de Repasse de Comissão</h3>

            <!-- Formulário para seleção do banco e da tabela de comissão -->
            <form method="POST" action="{{ url_for('fynance.comission_calc') }}" class="mb-4">
                <div class="mb-3">
                    <label for="banker_id" class="form-label">Selecione o Banco:</label>
                    <select name="banker_id" id="banker_id" class="form-select" required>
                        {% for banker in bankers %}
                            <option value="{{ banker.id }}">{{ banker.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="table_id" class="form-label">Selecione a Tabela de Comissão:</label>
                    <select name="table_id" id="table_id" class="form-select" required>
                        {% for table in tables %}
                            <option value="{{ table.id }}">{{ table.name }} - {{ table.rate }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="repasse_percentage" class="form-label">Percentual de Repasse (%):</label>
                    <input type="number" name="repasse_percentage" id="repasse_percentage" class="form-control"
                           min="0" max="100" step="0.01" required placeholder="Ex: 2.0">
                </div>

                <button type="submit" class="btn btn-primary w-100">Calcular Comissão</button>
            </form>

            <!-- Resultados das comissões calculadas -->
            {% if calculated_commissions %}
                <h3 class="h5 mb-3">Comissões Calculadas</h3>
                <ul class="list-group mb-4">
                    {% for commission in calculated_commissions %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            CPF: {{ commission.cpf }} | Valor Comissão: R$ {{ commission.valor_comissao }} | Repasse Comissão: R$ {{ commission.repasse_comissao }} | Vendedor: {{ commission.nome_vendedor }}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

            <!-- Exibição dos resultados -->
            {% if selected_table %}
                <h3 class="h5 mt-4">Comissão para a Tabela: {{ selected_table.name }}</h3>
                <p>Taxa Original: {{ selected_table.rate }}%</p>
                <p>Percentual de Repasse: {{ repasse_percentage }}%</p>
                <hr>

                <!-- Lista das comissões calculadas -->
                {% if calculated_commissions %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>CPF</th>
                                    <th>Vendedor</th>
                                    <th>Valor Comissão</th>
                                    <th>Repasse Comissão</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for commission in calculated_commissions %}
                                    <tr>
                                        <td>{{ commission.cpf }}</td>
                                        <td>{{ commission.nome_vendedor }}</td>
                                        <td>R$ {{ commission.valor_comissao }}</td>
                                        <td>R$ {{ commission.repasse_comissao }}</td>
                                        <td>{{ commission.status }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">Nenhuma proposta encontrada para a tabela selecionada.</p>
                {% endif %}
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}